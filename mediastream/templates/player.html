{% extends "base.html" %}
{% block player_head %}
  <link type="text/css" href="/static/jplayer.blue.monday.css" rel="stylesheet" />
  <script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.6/jquery.min.js"></script>
  <script type="text/javascript" src="/static/jquery.jplayer.min.js"></script>
  {% block player_script %}
  <script type="text/javascript">
    $(document).ready(function(){
      $("#jquery_jplayer_1").jPlayer({
        ready: function () {
          $(this).jPlayer("setMedia", {
            {% block player_setmedia %}{% endblock %}
          });
        },
        swfPath: "/static",
        supplied: "mp3",
        wmode: "window" // for Firefox 3.6 compatibility
      });
    });
  </script>
  {% endblock %}
  {% block player_events %}
  <script type="text/javascript" src="/static/ajax_csrf.js"></script>
  <script type="text/javascript">
    var send_event = function(event){
        var data = {
            user:           "{{ user.id }}",
            eventType:      event.type,
            currentTime:    event.jPlayer.status.currentTime,
            src:            event.jPlayer.status.src,
            seekPercent:    event.jPlayer.status.seekPercent,
            bufferPercent:  event.jPlayer.status.currentPercentRelative,
            playlistLength: $(".jp-playlist > ul > li").length
        };
        console.log("Handling event: "+event.type);
        $.post("{% url player_event %}", data, function(reply){
            $("#playeralerts").text(reply.response);
            {% block response_function %}{% endblock %}
        });
    };
    $(document).ready(function(){
      $("#jquery_jplayer_1").bind($.jPlayer.event.waiting, send_event);
      $("#jquery_jplayer_1").bind($.jPlayer.event.play, send_event);
      $("#jquery_jplayer_1").bind($.jPlayer.event.pause, send_event);
      $("#jquery_jplayer_1").bind($.jPlayer.event.ended, send_event);
    });
  </script>
  {% endblock %}
{% endblock %}
{% block player_body %}
  <p id="playeralerts"></p>
  <div id="jquery_jplayer_1" class="jp-jplayer"></div>
  <div id="jp_container_1" class="jp-audio">
    <div class="jp-type-single">
      <div class="jp-gui jp-interface">
        <ul class="jp-controls">
          <li><a href="javascript:;" class="jp-play" tabindex="1">play</a></li>
          <li><a href="javascript:;" class="jp-pause" tabindex="1">pause</a></li>
          <li><a href="javascript:;" class="jp-stop" tabindex="1">stop</a></li>
          <li><a href="javascript:;" class="jp-mute" tabindex="1" title="mute">mute</a></li>
          <li><a href="javascript:;" class="jp-unmute" tabindex="1" title="unmute">unmute</a></li>
          <li><a href="javascript:;" class="jp-volume-max" tabindex="1" title="max volume">max volume</a></li>
        </ul>
        <div class="jp-progress">
          <div class="jp-seek-bar">
            <div class="jp-play-bar"></div>
          </div>
        </div>
        <div class="jp-volume-bar">
          <div class="jp-volume-bar-value"></div>
        </div>
        <div class="jp-time-holder">
          <div class="jp-current-time"></div>
          <div class="jp-duration"></div>
          <ul class="jp-toggles">
            <li><a href="javascript:;" class="jp-repeat" tabindex="1" title="repeat">repeat</a></li>
            <li><a href="javascript:;" class="jp-repeat-off" tabindex="1" title="repeat off">repeat off</a></li>
          </ul>
        </div>
      </div>
      <div class="jp-title">
        {% block player_textbox %}{% endblock %}
      </div>
      <div class="jp-no-solution">
        <span>Update Required</span>
        To play the media you will need to either update your browser to a recent version or update your <a href="http://get.adobe.com/flashplayer/" target="_blank">Flash plugin</a>.
      </div>
    </div>
  </div>
{% endblock %}
